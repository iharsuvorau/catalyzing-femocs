CMAKE_MINIMUM_REQUIRED (VERSION 2.8.8)

# Setings

SET(TARGET "CatalystAdaptor")
SET(CMAKE_CXX_STANDARD 14)
SET(CMAKE_CXX_STANDARD_REQUIRED ON)
SET(CMAKE_Fortran_COMPILER gfortran)
SET(CMAKE_C_COMPILER gcc)
SET(CMAKE_CXX_COMPILER c++)
SET(CMAKE_VERBOSE_MAKEFILE off)
SET(CMAKE_BUILD_TYPE Release)

SET(FEMOCS_REPO_PATH ${CMAKE_SOURCE_DIR}/femocs)
SET(DEAL_II_DIR ${FEMOCS_REPO_PATH}/dealii)
SET(CGAL_DIR ${FEMOCS_REPO_PATH}/cgal)
SET(TET_DIR ${FEMOCS_REPO_PATH}/lib)
SET(GETELEC_DIR ${FEMOCS_REPO_PATH}/GETELEC/lib)
SET(SLATEC_DIR ${FEMOCS_REPO_PATH}/GETELEC/lib)
SET(FEMOCS_DIR ${FEMOCS_REPO_PATH}/lib)

SET(TET_PATH ${TET_DIR}/libtet.a)
SET(GETELEC_PATH ${GETELEC_DIR}/libgetelec.a)
SET(SLATEC_PATH ${SLATEC_DIR}/libslatec.a)
SET(FEMOCS_PATH ${FEMOCS_DIR}/libfemocs.a)

PROJECT(${TARGET})

# Dependencies

FIND_PACKAGE(deal.II 9.2 REQUIRED
    HINTS ${DEAL_II_DIR}
)
IF (NOT deal.II_FOUND)
    MESSAGE(FATAL_ERROR "Deal.II not found from " ${DEAL_II_DIR})
ENDIF()

DEAL_II_INITIALIZE_CACHED_VARIABLES()

ADD_LIBRARY(tet ${TET_DIR}/libtet.a)
SET_TARGET_PROPERTIES(tet PROPERTIES LINKER_LANGUAGE CXX)

ADD_LIBRARY(getelec ${GETELEC_DIR}/libgetelec.a)
SET_TARGET_PROPERTIES(getelec PROPERTIES LINKER_LANGUAGE Fortran)

ADD_LIBRARY(slatec ${SLATEC_DIR}/libslatec.a)
SET_TARGET_PROPERTIES(slatec PROPERTIES LINKER_LANGUAGE C)

ADD_LIBRARY(femocs ${FEMOCS_DIR}/libfemocs.a)
SET_TARGET_PROPERTIES(femocs PROPERTIES LINKER_LANGUAGE CXX)

# Compilation flags

SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fopenmp")
MESSAGE(STATUS "CMAKE_CXX_FLAGS = "${CMAKE_CXX_FLAGS})

# Building

ADD_EXECUTABLE(${TARGET} src/main.cpp)
DEAL_II_SETUP_TARGET(${TARGET})
target_include_directories(${TARGET} PRIVATE
    ${FEMOCS_REPO_PATH}/tetgen
    ${FEMOCS_REPO_PATH}/include
    ${FEMOCS_REPO_PATH}/GETELEC/modules
)
TARGET_LINK_LIBRARIES(${TARGET}
  ${TET_PATH}
  ${GETELEC_PATH}
  ${SLATEC_PATH}
  ${FEMOCS_PATH}
)
